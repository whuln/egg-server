(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fafe46dc"],{"56ff":function(e,t,s){"use strict";var a=s("c194"),r=s.n(a);r.a},7422:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("mu-appbar",{staticClass:"header",attrs:{color:"red"}},[s("mu-button",{attrs:{slot:"left",icon:""},on:{click:e.goHome},slot:"left"},[s("i",{staticClass:"material-icons"},[e._v("keyboard_arrow_left")])]),e._t("default")],2)],1)},r=[],n={name:"TaskHeader",methods:{goHome:function(){this.$router.push("home")}}},c=n,i=(s("56ff"),s("2877")),l=Object(i["a"])(c,a,r,!1,null,"19711852",null);t["a"]=l.exports},b025:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("task-header",[e._v("我的调度")]),s("mu-list",{on:{change:e.listChange}},e._l(e.carApplyinfos,function(t,a){return s("mu-list-item",{attrs:{button:"",ripple:!1,value:a}},[s("mu-list-item-title",[e._v(e._s(t.user.name)+" "),s("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.project))])]),s("mu-list-item-action",[s("div",[s("br"),s("span",[e._v(e._s(t.carnumber?"已派车":"待派车"))]),s("br"),s("span",[e._v(e._s(t.isback?"待收车":"未返回"))])])])],1)}),1),s("mu-dialog",{attrs:{title:"分配司机、车辆",scrollable:"",width:"600",transition:"slide-bottom",open:e.openAllotFullscreen},on:{"update:open":function(t){e.openAllotFullscreen=t}}},[s("mu-paper",{staticClass:"demo-list-wrap",attrs:{"z-depth":1}},[s("mu-list",[s("mu-list-item",[e._v("用车人："+e._s(e.caSelected.user?e.caSelected.user.name:""))]),s("mu-list-item",[e._v("部门 ："+e._s(e.caSelected.department))]),s("mu-list-item",[e._v("项目 ："+e._s(e.caSelected.project))]),s("mu-list-item",[e._v("用途："+e._s(e.caSelected.purpose))]),s("mu-list-item",[e._v("地点 ："+e._s(e.caSelected.places))]),s("mu-list-item",[e._v("计划出发时间："+e._s(e.caSelected.plantime1))]),s("mu-list-item",[e._v("计划回程时间："+e._s(e.caSelected.plantime2))]),s("mu-list-item",[e._v("是否省外："+e._s(e.caSelected.isshengwai?"省外":"省内"))]),e.caSelected.carnumber?s("mu-list-item",[e._v("车辆："+e._s(e.caSelected.carnumber))]):e._e(),e.caSelected.carnumber?s("mu-list-item",[e._v("司机："+e._s(e.caSelected.driver.name))]):e._e()],1),e._v("分配司机：\n      "),s("mu-select",{attrs:{disabled:e.caSelected.carnumber,"full-width":""},model:{value:e.selectDriverIndex,callback:function(t){e.selectDriverIndex=t},expression:"selectDriverIndex"}},e._l(e.useableDrivers,function(e,t){return s("mu-option",{key:t,attrs:{label:e.name,value:t}})}),1),e._v("分配车辆：\n      "),s("mu-select",{attrs:{disabled:e.caSelected.carnumber,"full-width":""},model:{value:e.selectCarIndex,callback:function(t){e.selectCarIndex=t},expression:"selectCarIndex"}},e._l(e.useableCars,function(e,t){return s("mu-option",{key:t,attrs:{label:e.number+","+e.brand+","+e.sites+"座",value:t}})}),1),s("mu-button",{attrs:{slot:"actions",disabled:e.caSelected.carnumber,color:"red"},on:{click:e.doSend},slot:"actions"},[e._v("确认派车")]),s("mu-button",{attrs:{slot:"actions",color:"red"},on:{click:e.doReceive},slot:"actions"},[e._v("确认收车")])],1)],1)],1)},r=[],n=(s("96cf"),s("3b8d")),c=s("cebc"),i=s("2f62"),l=s("7422"),o={name:"MyDispatch",components:{TaskHeader:l["a"]},data:function(){return{openAllotFullscreen:!1,carApplyinfos:[],useableDrivers:[],useableCars:[],selectedCaIndex:"",selectDriverIndex:"",selectCarIndex:"",caSelected:{}}},computed:Object(c["a"])({},Object(i["d"])(["userinfo","r"])),methods:{doReceive:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){var t,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this,e.prev=1,e.next=4,this.r.post("upsert_ucf",{id:this.caSelected.id,receiveraccount:this.userinfo.account,isreceived:1});case 4:t=e.sent,s=t.data,0==s.code&&(this.carApplyinfos.splice(this.selectedCaIndex,1),this.selectedCaIndex="",this.caSelected={},this.$alert("收车成功"),this.getUnallotedCarApplyinfos(),this.getUseableCars(),this.getUseableDrivers()),0!=s.code&&this.$alert("收车失败"),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](1),this.$alert("收车失败");case 13:this.openAllotFullscreen=!1;case 14:case"end":return e.stop()}},e,this,[[1,10]])}));function t(){return e.apply(this,arguments)}return t}(),doSend:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){var t,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this,e.prev=1,e.next=4,this.r.post("upsert_ucf",{id:this.caSelected.id,senderaccount:this.userinfo.account,driveraccount:this.useableDrivers[this.selectDriverIndex].account,carnumber:this.useableCars[this.selectCarIndex].number});case 4:t=e.sent,s=t.data,0==s.code&&(this.getUnallotedCarApplyinfos(),this.getUseableCars(),this.getUseableDrivers(),this.selectedCaIndex="",this.selectDriverIndex="",this.selectCarIndex="",this.caSelected={},this.$alert("车辆、司机分配成功")),0!=s.code&&this.$alert(s.msg),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](1),this.$alert("车辆、司机分配失败");case 13:this.openAllotFullscreen=!1;case 14:case"end":return e.stop()}},e,this,[[1,10]])}));function t(){return e.apply(this,arguments)}return t}(),listChange:function(e){this.selectedCaIndex=e,this.caSelected=this.carApplyinfos[this.selectedCaIndex],this.openAllotFullscreen=!0},getUseableDrivers:function(){var e=this;this.r.post("getusers",{rolename:"司机",state:0}).then(function(t){var s=t.data;0==s.code&&(e.useableDrivers=JSON.parse(s.msg)),1==s.code&&e.$alert(s.msg)}).catch(function(t){e.$alert(t)})},getUseableCars:function(){var e=this;this.r.post("getcars",{state:0}).then(function(t){var s=t.data;0==s.code&&(e.useableCars=JSON.parse(s.msg)),1==s.code&&e.$alert(s.msg)}).catch(function(t){e.$alert(t)})},getUnallotedCarApplyinfos:function(){var e=this;this.r.post("getucfs_admin").then(function(t){var s=t.data;0==s.code&&(e.carApplyinfos=s.msg),1==s.code&&e.$alert(s.msg)}).catch(function(t){e.$alert(t)})}},mounted:function(){this.getUnallotedCarApplyinfos(),this.getUseableCars(),this.getUseableDrivers()}},u=o,d=s("2877"),m=Object(d["a"])(u,a,r,!1,null,null,null);t["default"]=m.exports},c194:function(e,t,s){}}]);
//# sourceMappingURL=chunk-fafe46dc.b20e566a.js.map